[tox]
envlist = 
  lint
  py{35,37}-{base,full}-marshmallow{2,3}
  docs

[testenv]
passenv = DATABASE_URL
usedevelop = True
deps =
    marshmallow2: marshmallow>=2.2.0,<3.0.0
    marshmallow3: marshmallow>=3.0.0rc5,<4.0.0
extras =
    tests
    full: jwt

commands =
    # FIXME: We get screwed up coverage when using pytest-cov because we
    #  declare ourselves as a pytest plugin.
    coverage run -m pytest {posargs}
    coverage report

[testenv:lint]
deps = pre-commit~=1.17
skip_install = true
commands = pre-commit run --all-files

[testenv:docs]
extras = docs
commands = sphinx-build docs/ docs/_build {posargs}

; Below tasks are for development only (not run in CI)

[testenv:watch-docs]
deps =
  sphinx-autobuild
extras = docs
commands = sphinx-autobuild --open-browser docs/ docs/_build {posargs} -z flask_resty -s 2
