language: python
dist: xenial
services:
  - postgresql
matrix:
  include:
    - { python: "2.7",   env: "TOXENV=py-full-marshmallow2 DATABASE_URL=postgres://localhost/travis_ci_test" }
    - { python: "3.5",   env: "TOXENV=py-full-marshmallow2 DATABASE_URL=postgres://localhost/travis_ci_test" }
    - { python: "3.6",   env: "TOXENV=py-full-marshmallow2 DATABASE_URL=postgres://localhost/travis_ci_test" }
    - { python: "3.7",   env: "TOXENV=py-full-marshmallow2 DATABASE_URL=postgres://localhost/travis_ci_test" }

    - { python: "2.7",   env: "TOXENV=py-base-marshmallow2" }
    - { python: "3.6",   env: "TOXENV=py-base-marshmallow2" }

    - { python: "2.7",   env: "TOXENV=py-full-marshmallow3" }
    - { python: "3.6",   env: "TOXENV=py-full-marshmallow3" }
    - { python: "2.7",   env: "TOXENV=py-base-marshmallow3" }
    - { python: "3.6",   env: "TOXENV=py-base-marshmallow3" }

    - { python: "pypy2.7-6.0", env: "TOXENV=py-full-marshmallow2" }
    - { python: "pypy3.5-6.0", env: "TOXENV=py-full-marshmallow2" }

cache:
  directories:
    - $HOME/.cache/pip

before_install:
  - pip install -U pip
install:
  - pip install -U codecov tox

before_script:
  - psql -c 'CREATE DATABASE travis_ci_test' -U postgres
script:
  - python setup.py test

after_success:
  - codecov

branches:
  only:
    - master
